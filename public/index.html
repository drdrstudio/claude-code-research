<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRP Intelligence System v7.0 - Intake Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .form-container {
            padding: 40px;
        }

        .step {
            margin-bottom: 40px;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .step-title {
            font-size: 1.4em;
            color: #333;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input[type="text"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .helper-text {
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
        }

        .hidden {
            display: none;
        }

        .submit-section {
            background: #f8f9fa;
            padding: 30px;
            margin: -40px;
            margin-top: 40px;
            text-align: center;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 4px;
            margin-top: 20px;
            border-radius: 2px;
            overflow: hidden;
            display: none;
        }

        .progress-bar-fill {
            background: #667eea;
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù MRP Intelligence System v7.0</h1>
            <p>Strategic Intelligence & Reputational Analysis Intake Form</p>
        </div>

        <form id="mrpIntakeForm" class="form-container">
            <!-- Step 1: Project Type -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h2 class="step-title">Select Project Type</h2>
                </div>
                <div class="form-group">
                    <label for="projectType">What is the primary focus of this research? *</label>
                    <select id="projectType" name="projectType" required>
                        <option value="">-- Please select --</option>
                        <option value="individual">An Individual Person (Reputational Scan)</option>
                        <option value="organization">A Business / Organization (Reputational Scan)</option>
                        <option value="gtm">A Go-to-Market Strategy (GTM Project)</option>
                    </select>
                </div>
            </div>

            <!-- Step 2: Target Details -->
            <div class="step" id="step2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h2 class="step-title">Provide Target Details</h2>
                </div>

                <!-- Individual Person Fields -->
                <div id="individualFields" class="hidden">
                    <div class="form-group">
                        <label for="fullName">Full Name *</label>
                        <input type="text" id="fullName" name="fullName">
                        <div class="helper-text">Full legal name, e.g., "Thomas J. Watson Sr."</div>
                    </div>
                    <div class="form-group">
                        <label for="aliases">Known Aliases</label>
                        <input type="text" id="aliases" name="aliases">
                        <div class="helper-text">Nicknames, maiden names, etc., e.g., "Tom Watson"</div>
                    </div>
                    <div class="form-group">
                        <label for="currentRole">Current Role & Company *</label>
                        <input type="text" id="currentRole" name="currentRole">
                        <div class="helper-text">e.g., "Chairman and CEO of IBM"</div>
                    </div>
                    <div class="form-group">
                        <label for="primaryLocation">Primary Location *</label>
                        <input type="text" id="primaryLocation" name="primaryLocation">
                        <div class="helper-text">City, State/Country, e.g., "New York, NY"</div>
                    </div>
                </div>

                <!-- Organization Fields -->
                <div id="organizationFields" class="hidden">
                    <div class="form-group">
                        <label for="orgName">Organization Name *</label>
                        <input type="text" id="orgName" name="orgName">
                        <div class="helper-text">Full legal entity name, e.g., "International Business Machines Corporation"</div>
                    </div>
                    <div class="form-group">
                        <label for="orgAka">Also Known As (AKA)</label>
                        <input type="text" id="orgAka" name="orgAka">
                        <div class="helper-text">Common names, stock ticker, etc., e.g., "IBM, The Big Blue"</div>
                    </div>
                    <div class="form-group">
                        <label for="hqLocation">Headquarters Location *</label>
                        <input type="text" id="hqLocation" name="hqLocation">
                        <div class="helper-text">City, State/Country, e.g., "Armonk, New York"</div>
                    </div>
                    <div class="form-group">
                        <label for="keyIndividuals">Key Individuals to Scan</label>
                        <textarea id="keyIndividuals" name="keyIndividuals"></textarea>
                        <div class="helper-text">List names of CEO, Founder, key executives to include as second-level targets.</div>
                    </div>
                </div>

                <!-- GTM Fields -->
                <div id="gtmFields" class="hidden">
                    <div class="form-group">
                        <label for="productName">Product or Service Name *</label>
                        <input type="text" id="productName" name="productName">
                        <div class="helper-text">What are we taking to market? e.g., "MRP Intelligence System v7.0"</div>
                    </div>
                    <div class="form-group">
                        <label for="targetAudience">Target Audience / ICP *</label>
                        <textarea id="targetAudience" name="targetAudience"></textarea>
                        <div class="helper-text">Describe the Ideal Customer Profile. Job titles, industries, company size, pain points.</div>
                    </div>
                    <div class="form-group">
                        <label for="competitors">Top 3-5 Competitors *</label>
                        <textarea id="competitors" name="competitors"></textarea>
                        <div class="helper-text">List the main competitors we need to analyze.</div>
                    </div>
                    <div class="form-group">
                        <label for="valueProposition">Unique Value Proposition *</label>
                        <textarea id="valueProposition" name="valueProposition"></textarea>
                        <div class="helper-text">In one sentence, what makes this product unique and valuable?</div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Additional Instructions -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h2 class="step-title">Additional Instructions (Optional)</h2>
                </div>
                <div class="form-group">
                    <label for="specificConcerns">Specific Concerns or Questions</label>
                    <textarea id="specificConcerns" name="specificConcerns"></textarea>
                    <div class="helper-text">Are there any red flags or specific areas to focus on? e.g., "Verify claimed revenue numbers and check for history of litigation."</div>
                </div>
            </div>

            <!-- Submit Section -->
            <div class="submit-section">
                <button type="submit" class="submit-btn">Start Intelligence Gathering</button>
                <div class="progress-bar">
                    <div class="progress-bar-fill"></div>
                </div>
                <div class="status-message"></div>
            </div>
        </form>
    </div>

    <script>
        // Dynamic form behavior
        const projectTypeSelect = document.getElementById('projectType');
        const individualFields = document.getElementById('individualFields');
        const organizationFields = document.getElementById('organizationFields');
        const gtmFields = document.getElementById('gtmFields');
        const form = document.getElementById('mrpIntakeForm');
        const submitBtn = document.querySelector('.submit-btn');
        const statusMessage = document.querySelector('.status-message');
        const progressBar = document.querySelector('.progress-bar');
        const progressBarFill = document.querySelector('.progress-bar-fill');

        // Handle project type change
        projectTypeSelect.addEventListener('change', function() {
            // Hide all field groups
            individualFields.classList.add('hidden');
            organizationFields.classList.add('hidden');
            gtmFields.classList.add('hidden');

            // Clear required attributes
            document.querySelectorAll('#individualFields input, #organizationFields input, #gtmFields input, #gtmFields textarea').forEach(field => {
                field.removeAttribute('required');
            });

            // Show relevant fields and set required
            switch(this.value) {
                case 'individual':
                    individualFields.classList.remove('hidden');
                    document.getElementById('fullName').setAttribute('required', 'required');
                    document.getElementById('currentRole').setAttribute('required', 'required');
                    document.getElementById('primaryLocation').setAttribute('required', 'required');
                    break;
                case 'organization':
                    organizationFields.classList.remove('hidden');
                    document.getElementById('orgName').setAttribute('required', 'required');
                    document.getElementById('hqLocation').setAttribute('required', 'required');
                    break;
                case 'gtm':
                    gtmFields.classList.remove('hidden');
                    document.getElementById('productName').setAttribute('required', 'required');
                    document.getElementById('targetAudience').setAttribute('required', 'required');
                    document.getElementById('competitors').setAttribute('required', 'required');
                    document.getElementById('valueProposition').setAttribute('required', 'required');
                    break;
            }
        });

        // Handle form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Show progress
            submitBtn.disabled = true;
            submitBtn.textContent = 'Initiating Research...';
            progressBar.style.display = 'block';
            statusMessage.style.display = 'none';

            // Animate progress bar
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                progressBarFill.style.width = progress + '%';
                if (progress >= 90) {
                    clearInterval(progressInterval);
                }
            }, 200);

            // Prepare data based on project type
            const formData = new FormData(form);
            const projectType = formData.get('projectType');
            
            let researchData = {
                type: projectType === 'individual' ? 'individual' : 
                      projectType === 'organization' ? 'organization' : 'gtm',
                target: '',
                additional_prompt: formData.get('specificConcerns') || ''
            };

            // Set target based on type
            switch(projectType) {
                case 'individual':
                    researchData.target = formData.get('fullName');
                    researchData.details = {
                        aliases: formData.get('aliases'),
                        current_role: formData.get('currentRole'),
                        location: formData.get('primaryLocation')
                    };
                    break;
                case 'organization':
                    researchData.target = formData.get('orgName');
                    researchData.details = {
                        aka: formData.get('orgAka'),
                        hq_location: formData.get('hqLocation'),
                        key_individuals: formData.get('keyIndividuals')
                    };
                    break;
                case 'gtm':
                    researchData.target = formData.get('productName');
                    researchData.details = {
                        target_audience: formData.get('targetAudience'),
                        competitors: formData.get('competitors'),
                        value_proposition: formData.get('valueProposition')
                    };
                    break;
            }

            try {
                // Send to API
                const response = await fetch('/api/mrp/research', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(researchData)
                });

                const result = await response.json();

                if (result.success) {
                    // Success
                    progressBarFill.style.width = '100%';
                    statusMessage.className = 'status-message success';
                    statusMessage.textContent = `Research initiated successfully! Job ID: ${result.jobId}`;
                    statusMessage.style.display = 'block';
                    
                    // Store job ID for status checking
                    localStorage.setItem('currentJobId', result.jobId);
                    
                    // Redirect to status page after 2 seconds
                    setTimeout(() => {
                        window.location.href = `/status.html?jobId=${result.jobId}`;
                    }, 2000);
                } else {
                    throw new Error(result.error || 'Failed to start research');
                }
            } catch (error) {
                // Error
                clearInterval(progressInterval);
                progressBarFill.style.width = '100%';
                progressBar.style.background = '#f8d7da';
                statusMessage.className = 'status-message error';
                statusMessage.textContent = `Error: ${error.message}`;
                statusMessage.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Start Intelligence Gathering';
            }
        });

        // Form initialization complete
    </script>
</body>
</html>